<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shithead - Debug</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #0f4c3a, #1a7a5c);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .status {
            font-size: 24px;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }
        .btn {
            padding: 15px 30px;
            font-size: 18px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }
        .btn:hover { background: #45a049; }
        .debug {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            font-family: monospace;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>üÉè Shithead - Connection Test</h1>
    
    <div class="status" id="status">Initializing...</div>
    
    <button class="btn" onclick="testConnection()" id="testBtn">Test Connection</button>
    <button class="btn" onclick="createTestRoom()" id="createBtn" disabled>Create Room</button>
    
    <div class="debug" id="debug">
        <strong>Debug Log:</strong><br>
        <div id="debugLog">Starting...</div>
    </div>

    <script>
        let socket = null;
        let connectionStatus = 'disconnected';
        
        function log(message) {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `<br>[${timestamp}] ${message}`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }

        function updateStatus(status) {
            document.getElementById('status').textContent = status;
            connectionStatus = status;
        }

        function testConnection() {
            log('Attempting to connect to server...');
            updateStatus('Connecting...');
            
            try {
                // Try to connect to Socket.IO
                socket = io({
                    timeout: 10000,
                    transports: ['websocket', 'polling']
                });
                
                socket.on('connect', function() {
                    log('‚úÖ Connected successfully! Socket ID: ' + socket.id);
                    updateStatus('Connected!');
                    document.getElementById('createBtn').disabled = false;
                });

                socket.on('disconnect', function(reason) {
                    log('‚ùå Disconnected: ' + reason);
                    updateStatus('Disconnected');
                    document.getElementById('createBtn').disabled = true;
                });

                socket.on('connect_error', function(error) {
                    log('‚ùå Connection error: ' + error.message);
                    updateStatus('Connection Failed');
                });

                socket.on('error', function(error) {
                    log('‚ùå Socket error: ' + error);
                    updateStatus('Error occurred');
                });

                // Timeout fallback
                setTimeout(() => {
                    if (connectionStatus === 'Connecting...') {
                        log('‚è∞ Connection timeout - server may be down');
                        updateStatus('Connection Timeout');
                    }
                }, 15000);

            } catch (error) {
                log('‚ùå Failed to initialize socket: ' + error.message);
                updateStatus('Initialization Failed');
            }
        }

        function createTestRoom() {
            if (socket && socket.connected) {
                log('Sending createRoom event...');
                socket.emit('createRoom', 'TestPlayer');
                
                socket.on('roomCreated', function(data) {
                    log('‚úÖ Room created! Code: ' + data.roomCode);
                    updateStatus('Room Created: ' + data.roomCode);
                });
                
                socket.on('error', function(message) {
                    log('‚ùå Server error: ' + message);
                });
            } else {
                log('‚ùå Not connected to server');
            }
        }

        // Auto-start connection test
        document.addEventListener('DOMContentLoaded', function() {
            log('Page loaded, starting connection test...');
            testConnection();
        });
    </script>
</body>
</html>